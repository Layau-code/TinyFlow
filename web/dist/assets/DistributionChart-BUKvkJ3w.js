import{r as N,c as g,o as L,C as R,_ as H,w as O,D as T,d as m,e as v,f as c,i as I,y as j,t as b,F as k,p as A,q as $,l as V,E as W,G as q,H as G}from"./index-DPYHsNN2.js";const U={style:{position:"relative",width:"100%",height:"280px"}},Z={key:0,style:{position:"absolute",inset:"0",display:"flex","align-items":"center","justify-content":"center",color:"#9CA3AF","font-size":"14px","pointer-events":"none"}},J={__name:"EChartsPie",props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]}},setup(x){const s=x,h=N(null);let r=null,_=null,f=null;const D=g(()=>{const l=(s.data||[]).map(i=>Number((i==null?void 0:i.value)||0)),y=l.reduce((i,u)=>i+u,0);return l.length===0||y===0}),w=()=>s.colors&&s.colors.length?s.colors:["#6E44FF","#8A7CFD","#7A5BFF","#9D8BFF","#B0A4FF","#C7BEFF","#D6D1FF","#E0DCFF","#EAE8FF"],F=()=>{const l=(s.data||[]).filter(e=>Number((e==null?void 0:e.value)||0)>0).map(e=>({value:Number((e==null?void 0:e.value)||0),name:String((e==null?void 0:e.label)||(e==null?void 0:e.name)||"")})),y=l.reduce((e,d)=>e+(d.value||0),0),i=!l.length||y===0,u=Object.fromEntries(l.map(e=>[e.name,e.value]));return console.log("[EChartsPie] buildOption validData length:",l.length,"total:",y),{tooltip:{trigger:"item",formatter:({name:e,value:d,percent:a})=>`${e}：${d} (${a}%)`},legend:{orient:"vertical",right:10,top:"center",formatter:e=>{const d=u[e]??0;return`${e}  ${d}`}},color:w(),title:i?{text:"暂无数据",left:"center",top:"middle",textStyle:{color:"#9CA3AF",fontSize:16}}:void 0,series:[{name:"短链点击分布",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:24,fontWeight:"bold"}},labelLine:{show:!1},data:l}]}};return L(async()=>{var u,e,d,a,n;if(console.log("=== [EChartsPie] Mounted ==="),console.log("[EChartsPie] props.data:",s.data),await R(),console.log("[EChartsPie] el.value:",h.value),!h.value){console.warn("[EChartsPie] el.value is null");return}const l=((u=h.value)==null?void 0:u.clientWidth)||0,y=((e=h.value)==null?void 0:e.clientHeight)||0;console.log("[EChartsPie] mounted size:",l,y);try{const t=await H(()=>import("./index-C4rnF_7Z.js"),[]);_=t.default||t,console.log("[EChartsPie] ECharts loaded")}catch(t){console.error("[EChartsPie] ECharts load error:",t);return}try{r=_.init(h.value,null,{renderer:"svg"}),console.log("[EChartsPie] chart initialized")}catch(t){console.error("[EChartsPie] chart init error:",t);return}const i=F();console.log("[EChartsPie] init series length:",(n=(a=(d=i==null?void 0:i.series)==null?void 0:d[0])==null?void 0:a.data)==null?void 0:n.length),r.setOption(i,!0),r.resize(),setTimeout(()=>{try{r&&r.resize()}catch{}},120),f=new ResizeObserver(()=>{try{r&&r.resize()}catch{}}),f.observe(h.value)}),O(()=>s.data,l=>{if(console.log("[EChartsPie] data changed:",l),!r)return;const y=F();r.setOption(y,!0),r.resize()},{deep:!0}),T(()=>{try{f&&f.disconnect()}catch{}f=null;try{r&&r.dispose()}catch{}r=null}),(l,y)=>(v(),m("div",U,[c("div",{ref_key:"el",ref:h,style:{position:"absolute",inset:"0",width:"100%",height:"100%",background:"#fafafa",border:"1px dashed #ddd","border-radius":"8px"}},null,512),D.value?(v(),m("div",Z,"暂无数据")):I("",!0)]))}},K={class:"w-full"},Q={class:"text-xs text-[var(--text-secondary)] text-center mb-1"},X={class:"flex flex-wrap items-center justify-center gap-3 mb-3"},Y=["onMouseenter"],ee={class:"text-[var(--text-secondary)] text-sm"},te={class:"flex items-center justify-center"},ae={class:"relative",style:{width:"240px",height:"240px"}},oe={width:"240",height:"240",viewBox:"0 0 100 100",class:"absolute inset-0"},se={key:0},le=["d","fill"],ne={class:"absolute inset-0 flex items-center justify-center"},re={class:"text-center"},ce={class:"ml-4 text-sm"},ie=["onMouseenter"],ue={class:"text-[var(--text-secondary)]"},de={class:"font-medium text-[var(--text-primary)]"},ve={class:"text-[var(--text-secondary)] ml-1"},he={key:1,class:"q-help"},pe="var(--divider)",me={__name:"PieDonut",props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]}},setup(x){const s=x,h=g(()=>(s.data||[]).reduce((a,n)=>a+Number(n.value||0),0)),r=g(()=>h.value>0?h.value:1),_=g(()=>s.colors&&s.colors.length?s.colors:["#6E44FF","#8A7CFD","#7A5BFF","#9D8BFF","#B0A4FF","#C7BEFF","#D6D1FF","#E0DCFF","#EAE8FF"]),f=(a,n,t,o)=>({x:a+t*Math.cos(o),y:n+t*Math.sin(o)}),D=(a,n,t,o,p,C)=>{const P=C-p>Math.PI?1:0,E=f(a,n,o,p),M=f(a,n,o,C),z=f(a,n,t,C),B=f(a,n,t,p);return`M ${E.x} ${E.y} A ${o} ${o} 0 ${P} 1 ${M.x} ${M.y} L ${z.x} ${z.y} A ${t} ${t} 0 ${P} 0 ${B.x} ${B.y} Z`},w=g(()=>{let t=-Math.PI/2;return(s.data||[]).filter(p=>Number(p.value||0)>0).map(p=>{const C=Number(p.value||0)/r.value,P=t,E=t+C*2*Math.PI;return t=E,{path:D(50,50,20,40,P,E)}})}),F=a=>`${(a/r.value*100).toFixed(2)}%`,l=N(null),y=a=>{l.value=a},i=()=>{l.value=null},u=g(()=>l.value==null?null:s.data[l.value]),e=g(()=>l.value==null?"var(--text-secondary)":_.value[l.value%_.value.length]),d=g(()=>(s.data||[]).some(a=>Number(a.value||0)>0));return console.log("[Pie] data length:",(s.data||[]).length,"total:",h.value),O(()=>s.data,a=>{const n=(a||[]).map(o=>Number(o.value||0)),t=n.reduce((o,p)=>o+p,0);console.log("[Pie] data updated length:",n.length,"total:",t)},{deep:!0}),(a,n)=>(v(),m("div",K,[c("div",Q,"[调试] Pie 组件已挂载，hasData="+b(d.value?"是":"否"),1),c("div",X,[(v(!0),m(k,null,A(x.data,(t,o)=>(v(),m("div",{class:"flex items-center gap-2",key:o,onMouseenter:p=>y(o),onMouseleave:n[0]||(n[0]=p=>i())},[c("span",{class:"inline-block w-3 h-3 rounded",style:$({background:_.value[o%_.value.length]})},null,4),c("span",ee,b(t.label),1)],40,Y))),128))]),c("div",te,[c("div",ae,[(v(),m("svg",oe,[c("circle",{cx:"50",cy:"50",r:"40",stroke:pe,"stroke-width":"20",fill:"none"}),d.value?(v(),m("g",se,[(v(!0),m(k,null,A(w.value,(t,o)=>(v(),m("path",{key:o,d:t.path,fill:_.value[o%_.value.length],"fill-rule":"evenodd"},null,8,le))),128))])):I("",!0)])),c("div",ne,[c("div",re,[c("div",{class:"font-bold",style:$({fontSize:u.value?"28px":"20px",color:e.value})},b(d.value?u.value?u.value.label:"总点击":"暂无数据"),5),c("div",{class:"mt-1",style:$({fontSize:u.value?"18px":"14px",color:"var(--text-secondary)"})},b(d.value?u.value?F(u.value.value)+" · "+u.value.value:r.value:""),5)])])]),c("div",ce,[d.value?(v(!0),m(k,{key:0},A(x.data,(t,o)=>(v(),m("div",{class:"flex items-center gap-2",key:o,onMouseenter:p=>y(o),onMouseleave:n[1]||(n[1]=p=>i())},[c("span",{class:"inline-block w-3 h-3 rounded",style:$({background:_.value[o%_.value.length]})},null,4),c("span",ue,b(t.label),1),c("span",de,b(t.value),1),c("span",ve,"("+b(F(t.value))+")",1)],40,ie))),128)):(v(),m("div",he,"暂无数据或接口未返回"))])])]))}},S=j(me,[["__scopeId","data-v-9dcde100"]]),_e={__name:"DistributionChart",props:{type:{type:String,default:"pie"},data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]},engine:{type:String,default:"native"}},setup(x){const s=x,h=g(()=>({pie:s.engine==="echarts"?J:S})[s.type]||S),r=g(()=>({data:s.data,colors:s.colors}));return(_,f)=>(v(),m("div",null,[(v(),V(G(h.value),W(q(r.value)),null,16))]))}},fe=j(_e,[["__scopeId","data-v-a44ec0e6"]]);export{fe as default};
