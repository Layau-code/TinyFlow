import{y as ee,r as p,o as te,I as le,c as d,d as a,e as r,i as k,f as i,h as w,F as M,p as C,t as h,q as R}from"./index-DPYHsNN2.js";const oe=["width","height"],ne=["y1","x2","y2"],se=["y2"],ae=["y1","x2","y2"],re=["x","y"],ue={key:0},ce=["x","width","height","onMouseenter","onMousemove"],ie=["x1","x2","y2"],ve=["points","stroke","onMouseenter","onMousemove"],he=["onMouseenter","onMousemove"],ye=["cx","cy","fill"],de=["x","y","fill"],fe={key:2},xe=["x","y","width","height"],me=["x","y"],ke=["x","y","fill"],_e={key:3},be=["x","y"],ge={key:0},pe={key:1},we={key:2},s=24,N="var(--tf-blue-1)",F="var(--tf-border)",V="var(--text-secondary)",Me={__name:"TrendChart",props:{multi:{type:Boolean,default:!1},values:{type:Array,default:()=>[]},labels:{type:Array,default:()=>[]},series:{type:Array,default:()=>[]},width:{type:Number,default:640},height:{type:Number,default:240},showValues:{type:Boolean,default:!1}},setup(B){const v=B,X=p(null),_=p(v.width),f=v.height;let A;te(()=>{const t=()=>{var e;const u=((e=X.value)==null?void 0:e.clientWidth)||v.width;_.value=Math.max(200,Math.floor(u))};t();try{A=new ResizeObserver(t),X.value&&A.observe(X.value)}catch{}}),le(()=>{try{A&&A.disconnect()}catch{}});const S=d(()=>v.multi?v.series:[{name:"trend",color:N,series:(v.labels||[]).map((t,u)=>({label:t,value:v.values[u]||0}))}]),I=d(()=>{const t=[];return S.value.forEach(u=>u.series.forEach(e=>t.push(e.value||0))),Math.max(1,...t)}),E=d(()=>(_.value-s*2)/Math.max(1,(v.labels||[]).length-1));function G(t){return(S.value[t].series||[]).map((l,n)=>{const o=s+n*E.value,c=s+(f-s*2)*(1-(l.value||0)/I.value);return`${o},${c}`}).join(" ")}function b(t){return s+t*E.value}function H(t){return s+(f-s*2)*(1-(t||0)/I.value)}const J=d(()=>{const t=[];for(let e=0;e<=4;e++){const l=Math.round(I.value*e/4);t.push({value:l,y:H(l)})}return t}),K=d(()=>{const t=(v.labels||[]).length;return t<=16?1:t<=24?2:Math.ceil(t/6)}),W=d(()=>(v.labels||[]).length<=16),P=d(()=>!W.value),x=p(null),g=p(""),z=p(""),$=p(0),j=p("");function L(t,u,e,l,n){x.value=t,g.value=String(u),z.value=String(l||""),$.value=Number(e||0),j.value=String(n||"")}function T(){x.value=null,g.value="",z.value="",$.value=0,j.value=""}const Q=d(()=>(v.labels||[]).length>=25),Z=d(()=>{const t=[],u=(v.labels||[]).length,e=E.value;for(let l=0;l<u;l++){let o=b(l)-e/2;const c=s,y=_.value-s-e;o<c&&(o=c),o>y&&(o=y),t.push({x:o,w:e})}return t});function Y(t,u){var e;try{const l=(e=X.value)==null?void 0:e.getBoundingClientRect(),n=((u==null?void 0:u.clientX)||0)-((l==null?void 0:l.left)||0);let o=Math.round((n-s)/E.value);o=Math.max(0,Math.min(o,(v.labels||[]).length-1));const c=S.value[t],y=((c==null?void 0:c.series)||[])[o]||{label:(v.labels||[])[o],value:0};L(o,y.label,y.value,c==null?void 0:c.name,c==null?void 0:c.color)}catch{}}function q(t){const u=v.labels||[],e=S.value||[];let l=-1,n=-1;e.forEach((y,D)=>{var U;const O=Number(((U=((y==null?void 0:y.series)||[])[t])==null?void 0:U.value)||0);O>n&&(n=O,l=D)});const o=e[l]||e[0]||null,c=o?(o.series||[])[t]:null;L(t,u[t],c?c.value:0,o?o.name:"",o?o.color:"")}const m=d(()=>{if(x.value==null)return{x:0,y:0,w:132,h:34};const t=132,u=34,e=b(x.value),l=H($.value);let n=e+6,o=l-u-6;const c=n+t,y=_.value-s,D=s;return c>y&&(n=e-t-6),o<D&&(o=l+8),{x:n,y:o,w:t,h:u}});return(t,u)=>(r(),a("div",{class:"w-full",ref_key:"container",ref:X},[(r(),a("svg",{width:_.value,height:w(f),class:"overflow-visible"},[i("line",{x1:s,y1:w(f)-s,x2:_.value-s,y2:w(f)-s,stroke:F,"stroke-width":"1"},null,8,ne),i("line",{x1:s,y1:s,x2:s,y2:w(f)-s,stroke:F,"stroke-width":"1"},null,8,se),i("g",null,[(r(!0),a(M,null,C(J.value,(e,l)=>(r(),a("g",{key:"ytk-"+l},[i("line",{x1:s,y1:e.y,x2:_.value-s,y2:e.y,stroke:"var(--divider)","stroke-width":"0.5","stroke-dasharray":"2,2"},null,8,ae),i("text",{x:s-6,y:e.y+3,"text-anchor":"end",fill:V,"font-size":"10"},h(e.value),9,re)]))),128))]),Q.value?(r(),a("g",ue,[(r(!0),a(M,null,C(Z.value,(e,l)=>(r(),a("rect",{key:"hit-"+l,x:e.x,y:s,width:e.w,height:w(f)-s*2,fill:"transparent",style:{cursor:"crosshair"},onMouseenter:n=>q(l),onMousemove:n=>q(l),onMouseleave:T},null,40,ce))),128))])):k("",!0),x.value!==null?(r(),a("line",{key:1,x1:b(x.value),y1:s,x2:b(x.value),y2:w(f)-s,stroke:"var(--tf-blue-1)","stroke-width":"0.5","stroke-dasharray":"3,3"},null,8,ie)):k("",!0),(r(!0),a(M,null,C(S.value,(e,l)=>(r(),a("g",{key:l},[i("polyline",{points:G(l),stroke:e.color||N,fill:"none","stroke-width":"1.5",style:{"pointer-events":"visibleStroke",cursor:"crosshair"},onMouseenter:n=>Y(l,n),onMousemove:n=>Y(l,n),onMouseleave:T},null,40,ve),i("g",null,[(r(!0),a(M,null,C(e.series,(n,o)=>(r(),a("g",{key:o,onMouseenter:c=>L(o,n.label,n.value,e.name,e.color),onMousemove:c=>L(o,n.label,n.value,e.name,e.color),onMouseleave:T},[i("circle",{cx:b(o),cy:H(n.value),r:"2",fill:e.color||N,class:"pt"},[i("title",null,h(n.label)+": "+h(n.value),1)],8,ye),!B.multi&&B.showValues?(r(),a("text",{key:0,x:b(o),y:H(n.value)-6,"text-anchor":"middle","font-size":"10",fill:e.color||N},h(n.value),9,de)):k("",!0)],40,he))),128))])]))),128)),x.value!==null&&z.value?(r(),a("g",fe,[i("rect",{x:m.value.x,y:m.value.y,width:m.value.w,height:m.value.h,rx:"6",ry:"6",fill:"#ffffff",stroke:F,"stroke-width":"0.8"},null,8,xe),i("text",{x:m.value.x+8,y:m.value.y+14,fill:V,"font-size":"11"},h(g.value),9,me),i("text",{x:m.value.x+8,y:m.value.y+28,fill:j.value||N,"font-size":"12"},h(z.value)+"："+h($.value),9,ke)])):k("",!0),P.value?(r(),a("g",_e,[t.i%K.value===0?(r(!0),a(M,{key:0},C(B.labels,(e,l)=>(r(),a("g",{key:"lab-"+l},[i("text",{x:b(l),y:w(f)-s+14,"text-anchor":"middle",fill:V,"font-size":"10"},h(e),9,be)]))),128)):k("",!0)])):k("",!0)],8,oe)),W.value?(r(),a("div",{key:0,class:"flex justify-between text-xs mt-2",style:R({color:V})},[(r(!0),a(M,null,C(B.labels,(e,l)=>(r(),a("span",{key:"bl-"+l},h(e),1))),128))],4)):k("",!0),B.multi?(r(),a("div",{key:1,class:"flex flex-wrap gap-3 text-xs mt-2",style:R({color:V})},[(r(!0),a(M,null,C(S.value,(e,l)=>(r(),a("div",{key:"legend-"+l,class:"flex items-center gap-1"},[i("span",{class:"inline-block w-2.5 h-2.5 rounded",style:R({background:e.color||N})},null,4),i("span",null,h(e.name),1)]))),128))],4)):k("",!0),i("div",{class:"flex justify-center text-xs mt-2",style:R({color:V})},[g.value&&z.value?(r(),a("span",ge,h(g.value)+" · "+h(z.value)+"："+h($.value),1)):g.value?(r(),a("span",pe,h(g.value),1)):(r(),a("span",we," "))],4)],512))}},Be=ee(Me,[["__scopeId","data-v-e425ca29"]]);export{Be as default};
