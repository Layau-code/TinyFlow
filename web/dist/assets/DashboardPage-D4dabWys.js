const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TrendChart-DmtAff2h.js","assets/index-4vDheKbt.js","assets/index-BlnMaqU-.css","assets/TrendChart-L8faHN-W.css","assets/DistributionChart-wh40PKkL.js","assets/DistributionChart-91z5xMqA.css"])))=>i.map(i=>d[i]);
import{u as ht,r as x,c as m,w as R,o as vt,a as pt,b as u,d as c,e as t,f as G,v as bt,g as h,h as b,i as F,j as J,t as d,F as Q,k as W,n as _t,l as g,m as X,p as ft,q,S as Y,_ as Z}from"./index-4vDheKbt.js";import{u as xt,a as gt,b as Ct}from"./useStats-CSNqs6-Y.js";const yt={class:"min-h-screen q-page font-[Inter,system-ui,-apple-system,sans-serif]"},kt={class:"max-w-6xl mx-auto p-6"},Ft={class:"flex items-center justify-between mb-8"},Vt={class:"flex items-center gap-4"},Dt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"},Tt={class:"q-card p-6",style:{"box-shadow":"0 2px 12px rgba(0,0,0,0.04)"}},St={class:"relative",style:{height:"280px",background:"#fafafa",border:"1px dashed #ddd","border-radius":"8px"}},Et={key:0,class:"q-muted text-center mt-2"},Lt={class:"q-help mt-1"},At={class:"q-card p-6",style:{"box-shadow":"0 2px 12px rgba(0,0,0,0.04)"}},Ut={class:"relative",style:{height:"280px",background:"#fafafa",border:"1px dashed #ddd","border-radius":"8px"}},Rt={key:0,class:"q-muted text-center mt-2"},qt={class:"q-help mt-1"},Nt={class:"md-card p-5 mb-10"},Bt={class:"overflow-x-auto"},jt={class:"md-table"},Pt={class:"md-td font-medium"},wt={class:"md-td truncate max-w-[420px] md-muted"},Mt={class:"md-td text-right md-nums"},It={style:{color:"#6E44FF"}},Ot={class:"md-td text-right md-nums"},$t={class:"md-td"},zt={class:"flex items-center gap-2"},Ht={class:"w-[160px] h-2 rounded",style:{background:"var(--divider)"}},Kt={class:"md-muted"},Gt={class:"md-td"},Jt={class:"md-td"},Qt={class:"flex items-center gap-3 md-actions"},Wt=["onClick"],Xt=["onClick"],Yt={key:0},Zt={key:1},te={class:"flex items-center justify-between mt-4"},ee={class:"md-muted"},se={class:"md-card p-5 mb-10"},oe={class:"overflow-x-auto"},ae={class:"md-table"},le={class:"md-td"},de=["onUpdate:modelValue"],ne={class:"md-td font-medium"},ie={class:"md-td truncate max-w-[420px] md-muted"},ce={class:"md-td text-right md-nums"},re={class:"md-td text-right md-nums"},ue={class:"md-td"},me={class:"md-td"},he={class:"flex items-center gap-3 md-actions"},ve=["onClick"],pe=["onClick"],be={key:0},_e={key:1},fe={class:"flex items-center justify-between mt-4"},xe={class:"md-muted"},ge={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Ce={class:"md-card p-5"},ye={key:0,class:"md-muted"},ke={class:"md-card p-5"},N=10,Te={__name:"DashboardPage",setup(Fe){const tt=J(()=>Z(()=>import("./TrendChart-DmtAff2h.js"),__vite__mapDeps([0,1,2,3]))),D=J(()=>Z(()=>import("./DistributionChart-wh40PKkL.js"),__vite__mapDeps([4,1,2,5]))),et=ht();function st(){et.push("/")}const T=x(""),v=x(1),_=x({}),{data:ot,loading:V,refresh:S}=xt(),{data:E,refresh:at}=gt(),f=ot,B=["#6E44FF","#8A7CFD","#7A5BFF","#9D8BFF","#B0A4FF","#C7BEFF","#D6D1FF","#E0DCFF","#EAE8FF"],C=m(()=>j(E.value||[],"totalVisits")),y=m(()=>j(E.value||[],"todayVisits")),lt=m(()=>(C.value||[]).reduce((o,e)=>o+Number(e.value||0),0)>0),dt=m(()=>(y.value||[]).reduce((o,e)=>o+Number(e.value||0),0)>0),nt=m(()=>(C.value||[]).reduce((o,e)=>o+Number(e.value||0),0)),it=m(()=>(y.value||[]).reduce((o,e)=>o+Number(e.value||0),0));R([y,C],([o,e])=>{try{const a=(o||[]).reduce((l,n)=>l+Number(n.value||0),0),s=(e||[]).reduce((l,n)=>l+Number(n.value||0),0);console.log("[Dashboard] Pie sums => today:",a,", total:",s)}catch{}}),R(f,o=>{try{console.log("[Dashboard] list length:",(o||[]).length,"first item:",(o||[])[0])}catch{}}),R(E,o=>{try{console.log("[Dashboard] click-stats length:",(o||[]).length,"first item:",(o||[])[0])}catch{}});function j(o,e){const s=(o||[]).map(i=>({name:i.shortCode,label:i.shortCode,value:Number(i[e]||0)})).sort((i,r)=>r.value-i.value);if(s.reduce((i,r)=>i+r.value,0),s.length<=8)return s;const l=s.slice(0,7),n=s.slice(7).reduce((i,r)=>i+r.value,0);return n>0&&l.push({name:"其他",label:"其他",value:n}),l}const L=m(()=>{const o=p.value||[],e=o.reduce((s,l)=>s+Number(l.totalVisits||0),0)||1,a={};return o.forEach(s=>{a[s.shortCode]=Number(s.totalVisits||0)/e*100}),a});function ct(){const o=["Short Code","Total","Today","占比(%)","Created At","URL"],a=(p.value||[]).map(r=>[r.shortCode,r.totalVisits??"-",r.todayVisits??"-",(L.value[r.shortCode]||0).toFixed(2),U(r.createdAt),r.longUrl||""]),s=[o.join(","),...a.map(r=>r.join(","))].join(`
`),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download="短链点击详情.csv",i.click(),URL.revokeObjectURL(n)}const p=m(()=>{const o=T.value.trim().toLowerCase();return o?(f.value||[]).filter(e=>(e.shortCode||"").toLowerCase().includes(o)||(e.longUrl||"").toLowerCase().includes(o)):f.value||[]}),A=m(()=>Math.max(1,Math.ceil(p.value.length/N))),P=m(()=>p.value.slice((v.value-1)*N,v.value*N));function w(){v.value=Math.max(1,v.value-1)}function M(){v.value=Math.min(A.value,v.value+1)}const{data:I,refresh:O}=Ct(),k=x([]),$=x([]),z=x({});async function rt(){const o=Object.keys(_.value).filter(s=>_.value[s]);if(!o.length){k.value=[];return}await O(o,7);const e=I.value||{},a=new Set;k.value=o.map(s=>{const l=(e[s]||[]).map(n=>({label:n.date,value:n.visits}));return l.forEach(n=>a.add(n.label)),{name:s,color:"#00B976",series:l}}),$.value=Array.from(a)}async function ut(o){if(!o.length){z.value={};return}await O(o,7);const e=I.value||{},a={};o.forEach(s=>{const l=e[s]||[];a[s]=l.reduce((n,i)=>n+Number(i.visits||0),0)}),z.value=a}const mt=m(()=>[...f.value||[]].sort((e,a)=>(a.totalVisits||0)-(e.totalVisits||0)).slice(0,5).map(e=>({label:e.shortCode,value:e.totalVisits})));function U(o){try{return new Date(o).toLocaleString()}catch{return String(o)}}vt(async()=>{await Promise.all([S(),at()]);const o=[...f.value||[]].sort((a,s)=>(s.totalVisits||0)-(a.totalVisits||0)).slice(0,3);_.value={},o.forEach(a=>_.value[a.shortCode]=!0),await rt();const e=[...f.value||[]].sort((a,s)=>(s.totalVisits||0)-(a.totalVisits||0)).slice(0,10).map(a=>a.shortCode);await ut(e)});function H(o){try{navigator.clipboard.writeText(String(o))}catch(e){console.log("copy failed",e)}}function K(o){console.log("remove clicked",o)}return(o,e)=>{const a=pt("router-link");return c(),u("div",yt,[t("div",kt,[t("div",Ft,[e[2]||(e[2]=t("h1",{class:"md-text text-[24px] font-medium"},"我的短链统计",-1)),t("div",Vt,[t("button",{onClick:st,class:"md-btn-text"},"返回首页"),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>T.value=s),type:"text",placeholder:"搜索短码或域名",class:"h-9 px-3 rounded-lg border",style:{"border-color":"#E5E7EB",background:"#FFFFFF",color:"#333333"}},null,512),[[bt,T.value]]),t("button",{onClick:e[1]||(e[1]=(...s)=>h(S)&&h(S)(...s)),class:"md-btn-text"},"刷新")])]),t("div",Dt,[t("div",Tt,[e[3]||(e[3]=t("div",{class:"q-card-title mb-4"},"今日点击分布",-1)),t("div",St,[F(h(D),{type:"pie",data:y.value,colors:B,engine:"echarts"},null,8,["data"])]),dt.value?b("",!0):(c(),u("div",Et,"暂无数据")),t("div",Lt,"数据条数："+d(y.value.length)+"，总和："+d(it.value),1),e[4]||(e[4]=t("div",{class:"q-help mt-3"},"悬停查看名称、百分比与数值",-1))]),t("div",At,[e[5]||(e[5]=t("div",{class:"q-card-title mb-4"},"总点击分布",-1)),t("div",Ut,[F(h(D),{type:"pie",data:C.value,colors:B,engine:"echarts"},null,8,["data"])]),lt.value?b("",!0):(c(),u("div",Rt,"暂无数据")),t("div",qt,"数据条数："+d(C.value.length)+"，总和："+d(nt.value),1),e[6]||(e[6]=t("div",{class:"q-help mt-3"},"悬停查看名称、百分比与数值",-1))])]),t("div",Nt,[t("div",{class:"flex items-center justify-between mb-3"},[e[7]||(e[7]=t("div",{class:"md-label"},"短链点击详情",-1)),t("button",{class:"md-btn",onClick:ct},"导出 CSV")]),t("div",Bt,[t("table",jt,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",{class:"md-th text-left"},"Short Code"),t("th",{class:"md-th text-left"},"URL"),t("th",{class:"md-th text-right"},"Total"),t("th",{class:"md-th text-right"},"Today"),t("th",{class:"md-th text-left"},"占总点击比例"),t("th",{class:"md-th text-left"},"Created At"),t("th",{class:"md-th text-left"},"操作")])],-1)),t("tbody",null,[(c(!0),u(Q,null,W(P.value,s=>(c(),u("tr",{key:s.shortCode,class:"md-tr"},[t("td",Pt,d(s.shortCode),1),t("td",wt,d(s.longUrl),1),t("td",Mt,[t("span",It,d(s.totalVisits??"-"),1)]),t("td",Ot,d(s.todayVisits===0?"-":s.todayVisits??"-"),1),t("td",$t,[t("div",zt,[t("div",Ht,[t("div",{class:"h-2 rounded",style:_t({width:(L.value[s.shortCode]||0).toFixed(2)+"%",background:"#8A7CFD"})},null,4)]),t("span",Kt,d((L.value[s.shortCode]||0).toFixed(2))+"%",1)])]),t("td",Gt,d(U(s.createdAt)),1),t("td",Jt,[t("div",Qt,[F(a,{to:"/stats/"+encodeURIComponent(s.shortCode),class:"md-btn-text"},{default:g(()=>[...e[8]||(e[8]=[X("统计",-1)])]),_:1},8,["to"]),t("button",{class:"md-btn-text",onClick:l=>H(o.location.origin+"/"+s.shortCode)},"复制",8,Wt),t("button",{class:"md-btn-text",onClick:l=>K(s.shortCode)},"删除",8,Xt)])])]))),128)),h(V)?(c(),u("tr",Yt,[...e[9]||(e[9]=[t("td",{colspan:"7",class:"p-4 text-center md-muted"},"加载中…",-1)])])):b("",!0),!h(V)&&p.value.length===0?(c(),u("tr",Zt,[...e[10]||(e[10]=[t("td",{colspan:"7",class:"p-4 text-center md-muted"},"暂无数据",-1)])])):b("",!0)])])]),t("div",te,[t("div",ee,"共 "+d(p.value.length)+" 条，当前第 "+d(v.value)+" / "+d(A.value)+" 页",1),t("div",{class:"flex items-center gap-3"},[t("button",{onClick:w,class:"md-btn-text"},"上一页"),t("button",{onClick:M,class:"md-btn-text"},"下一页")])])]),t("div",se,[t("div",oe,[t("table",ae,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",{class:"md-th text-left"},"选择"),t("th",{class:"md-th text-left"},"Short Code"),t("th",{class:"md-th text-left"},"URL"),t("th",{class:"md-th text-right"},"Total"),t("th",{class:"md-th text-right"},"Today"),t("th",{class:"md-th text-left"},"Created At"),t("th",{class:"md-th text-left"},"操作")])],-1)),t("tbody",null,[(c(!0),u(Q,null,W(P.value,s=>(c(),u("tr",{key:s.shortCode,class:"md-tr"},[t("td",le,[G(t("input",{type:"checkbox","onUpdate:modelValue":l=>_.value[s.shortCode]=l},null,8,de),[[ft,_.value[s.shortCode]]])]),t("td",ne,d(s.shortCode),1),t("td",ie,d(s.longUrl),1),t("td",ce,d(s.totalVisits??"-"),1),t("td",re,d(s.todayVisits===0?"-":s.todayVisits??"-"),1),t("td",ue,d(U(s.createdAt)),1),t("td",me,[t("div",he,[F(a,{to:"/stats/"+encodeURIComponent(s.shortCode),class:"md-btn-text"},{default:g(()=>[...e[12]||(e[12]=[X("统计",-1)])]),_:1},8,["to"]),t("button",{class:"md-btn-text",onClick:l=>H(o.location.origin+"/"+s.shortCode)},"复制",8,ve),t("button",{class:"md-btn-text",onClick:l=>K(s.shortCode)},"删除",8,pe)])])]))),128)),h(V)?(c(),u("tr",be,[...e[13]||(e[13]=[t("td",{colspan:"7",class:"p-4 text-center md-muted"},"加载中…",-1)])])):b("",!0),!h(V)&&p.value.length===0?(c(),u("tr",_e,[...e[14]||(e[14]=[t("td",{colspan:"7",class:"p-4 text-center md-muted"},"暂无数据",-1)])])):b("",!0)])])]),t("div",fe,[t("div",xe,"共 "+d(p.value.length)+" 条，当前第 "+d(v.value)+" / "+d(A.value)+" 页",1),t("div",{class:"flex items-center gap-3"},[t("button",{onClick:w,class:"md-btn-text"},"上一页"),t("button",{onClick:M,class:"md-btn-text"},"下一页")])])]),t("div",ge,[t("div",Ce,[e[17]||(e[17]=t("div",{class:"md-label mb-3"},"最近7天访问趋势对比",-1)),(c(),q(Y,null,{fallback:g(()=>[...e[16]||(e[16]=[t("div",{class:"h-[240px] md-card"},null,-1)])]),default:g(()=>[k.value.length?(c(),q(h(tt),{key:0,multi:!0,series:k.value,labels:$.value},null,8,["series","labels"])):b("",!0)]),_:1})),k.value.length?b("",!0):(c(),u("div",ye,"请选择至少一个短链进行对比"))]),t("div",ke,[e[19]||(e[19]=t("div",{class:"md-label mb-3"},"总点击量对比（Top 5）",-1)),(c(),q(Y,null,{fallback:g(()=>[...e[18]||(e[18]=[t("div",{class:"h-[240px] md-card"},null,-1)])]),default:g(()=>[F(h(D),{type:"bar",data:mt.value},null,8,["data"])]),_:1}))])])])])}}};export{Te as default};
