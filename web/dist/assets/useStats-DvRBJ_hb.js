import{r as y,x as u,_ as b}from"./index-DPYHsNN2.js";var A,h;const w=((h=(A=import.meta)==null?void 0:A.env)==null?void 0:h.VITE_SHORT_BASE)||(typeof window<"u"&&window.location&&window.location.origin?window.location.origin:"http://localhost:8080");var m,g;const l=((g=(m=import.meta)==null?void 0:m.env)==null?void 0:g.VITE_API_BASE)||"",_=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:l,SHORT_BASE:w},Symbol.toStringTag,{value:"Module"}));function v(){return{data:y(null),loading:y(!1),error:y(null)}}function S(){const r=v();return{...r,refresh:async()=>{var n;r.loading.value=!0,r.error.value=null;try{const a=await u.get(l?l+"/api/urls":"/api/urls"),t=(a==null?void 0:a.data)??null,c=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.content)?t.content:Array.isArray(t==null?void 0:t.items)?t.items:Array.isArray((n=t==null?void 0:t.data)==null?void 0:n.content)?t.data.content:[];try{const{SHORT_BASE:i}=await b(async()=>{const{SHORT_BASE:e}=await Promise.resolve().then(()=>_);return{SHORT_BASE:e}},void 0);r.data.value=(c||[]).map(e=>{const s=String((e==null?void 0:e.shortUrl)||""),d=(s.split("/").pop()||"").split("?")[0],f=String((e==null?void 0:e.shortCode)||d||""),p=f?`${i}/${encodeURIComponent(f)}`:s;return{...e,shortUrl:p}})}catch{r.data.value=c}}catch(a){r.error.value=a}finally{r.loading.value=!1}}}}function E(r){const o=v();return{...o,refresh:async()=>{o.loading.value=!0,o.error.value=null;try{const a=await u.get((l||"")+`/api/stats/overview/${encodeURIComponent(r)}`),t=(a==null?void 0:a.data)??null,c=(t==null?void 0:t.data)??(t==null?void 0:t.result)??t;o.data.value=c||null}catch(a){o.error.value=a}finally{o.loading.value=!1}}}}function O(r,o=7){const n=v(),a=()=>typeof o=="object"&&o!==null&&"value"in o?o.value??7:o;return{...n,refresh:async()=>{n.loading.value=!0,n.error.value=null;try{const c=a();console.debug("[trend] GET /api/stats/trend",{shortCode:r,days:c});const i=await u.get((l||"")+`/api/stats/trend/${encodeURIComponent(r)}`,{params:{days:c}}),e=(i==null?void 0:i.data)??null,s=Array.isArray(e)?e:Array.isArray(e==null?void 0:e.items)?e.items:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.content)?e.content:[];n.data.value=s}catch(c){console.error("[trend] request failed",c),n.error.value=c}finally{n.loading.value=!1}}}}function j(r,o){const n=v();return{...n,refresh:async()=>{n.loading.value=!0,n.error.value=null;try{const t=o&&o.value?{...o.value}:{},c={code:r,...Object.fromEntries(Object.entries(t).filter(([d,f])=>f!=null&&String(f).trim()!==""))},i=await u.post((l||"")+"/api/stats/distribution",c,{headers:{"Content-Type":"application/json;charset=utf-8"}}),e=(i==null?void 0:i.data)??null,s=(e==null?void 0:e.data)??(e==null?void 0:e.result)??e??{};n.data.value={device:Array.isArray(s==null?void 0:s.device)?s.device:Array.isArray(s==null?void 0:s.devices)?s.devices:[],city:Array.isArray(s==null?void 0:s.city)?s.city:Array.isArray(s==null?void 0:s.cities)?s.cities:[],referer:Array.isArray(s==null?void 0:s.referer)?s.referer:Array.isArray(s==null?void 0:s.referrers)?s.referrers:[]}}catch(t){n.error.value=t}finally{n.loading.value=!1}}}}function C(){const r=v();return{...r,refresh:async(n,a=7)=>{r.loading.value=!0,r.error.value=null;try{const t=await u.get((l||"")+"/api/stats/compare",{params:{trends:n.join(","),days:a}});r.data.value=(t==null?void 0:t.data)||{}}catch(t){r.error.value=t}finally{r.loading.value=!1}}}}function R(){const r=y(!1);async function o(n){try{return await navigator.clipboard.writeText(n),r.value=!0,setTimeout(()=>r.value=!1,2e3),!0}catch{return!1}}return{copied:r,copy:o}}function U(){const r=v();return{...r,refresh:async()=>{r.loading.value=!0,r.error.value=null;try{const n=await u.get("/api/urls/click-stats"),a=(n==null?void 0:n.data)??null,t=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a==null?void 0:a.content)?a.content:[];r.data.value=t.map(c=>({shortCode:c==null?void 0:c.shortCode,totalVisits:Number((c==null?void 0:c.totalVisits)??0),todayVisits:Number((c==null?void 0:c.todayVisits)??0)}))}catch(n){r.error.value=n}finally{r.loading.value=!1}}}}async function I(r,o={},n="csv"){const a=(l||"")+`/api/stats/export?format=${encodeURIComponent(n)}`,t={code:r,...Object.fromEntries(Object.entries(o||{}).filter(([s,d])=>d!=null&&String(d).trim()!==""))},i=(await u.post(a,t,{responseType:"blob",headers:{"Content-Type":"application/json;charset=utf-8"}})).data,e=document.createElement("a");e.href=URL.createObjectURL(i),e.download=`stats-${r}-${n}.`+(n==="csv"?"csv":"json"),document.body.appendChild(e),e.click(),setTimeout(()=>{URL.revokeObjectURL(e.href),document.body.removeChild(e)},100)}export{l as A,w as S,U as a,C as b,R as c,E as d,j as e,O as f,I as g,S as u};
