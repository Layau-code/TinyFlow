const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DistributionChart-BUKvkJ3w.js","assets/index-DPYHsNN2.js","assets/index-Bnqld3q_.css","assets/DistributionChart-91z5xMqA.css","assets/TrendChart-DvXSpqmb.js","assets/TrendChart-EpDOQCrt.css","assets/SourceHBarChart-BKfcQQxX.js"])))=>i.map(i=>d[i]);
import{y as $l,z as Fl,a as Nl,r as a,c as Tl,w as _l,o as Al,d as r,f as l,i as b,t as o,h as u,n as K,l as L,m as x,S as E,g as h,v as N,A as Rl,B as Bl,F as Ll,p as El,s as Ml,u as Ol,e as i,j as M,k as O,_ as j}from"./index-DPYHsNN2.js";import{c as jl,d as Pl,e as Ul,f as Il,S as Q,g as Hl}from"./useStats-DvRBJ_hb.js";const zl={class:"min-h-screen q-page pt-24 md:pt-28"},Jl={class:"max-w-6xl mx-auto p-6 space-y-10"},Yl={class:"flex items-center justify-between"},Zl={class:"q-muted flex items-center gap-2"},Gl={class:"flex items-center gap-3"},Kl={class:"grid grid-cols-1 gap-8"},Ql={class:"q-card p-5"},Wl={class:"q-card-title mb-3 flex items-center gap-2"},Xl={class:"ml-auto flex items-center gap-2"},lt={class:"relative",style:{height:"260px",background:"#fafafa",border:"1px dashed #ddd","border-radius":"8px"}},tt={key:0,class:"q-muted text-center mt-2"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-8"},st={class:"q-card p-5"},nt={key:0,class:"q-muted"},at={class:"q-card p-5"},ot={key:0,class:"q-muted"},ut={key:0,class:"tf-modal-backdrop"},it={class:"tf-modal"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},dt={class:"q-card p-6"},pt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 items-start"},ct={class:"mt-1 q-strong"},vt={class:"mt-1 q-strong"},mt={class:"mt-1 q-nums"},ft={class:"mt-1 q-nums"},bt={class:"mt-2 space-y-1"},xt={class:"q-muted"},gt={class:"q-nums"},yt={key:0,class:"q-muted"},wt={key:1,class:"p-4 rounded q-card"},qt={__name:"StatsPage",setup(kt){const W=O(()=>j(()=>import("./DistributionChart-BUKvkJ3w.js"),__vite__mapDeps([0,1,2,3]))),X=O(()=>j(()=>import("./TrendChart-DvXSpqmb.js"),__vite__mapDeps([4,1,2,5]))),ll=O(()=>j(()=>import("./SourceHBarChart-BKfcQQxX.js"),__vite__mapDeps([6,1,2]))),tl=Fl(),P=Ol(),d=tl.params.shortCode,U=`${Q}/${encodeURIComponent(d)}`,el=`${Q}/${String(d)}`,{copy:sl}=jl(),{t:g}=Nl(),{data:nl,error:al,refresh:ol}=Pl(d),I=a({start:"",end:"",source:"",device:"",city:"",page:0,size:20}),{data:ul,loading:il,error:rl,refresh:dl}=Ul(d,I),m=a(7),{data:H,loading:pl,error:cl,refresh:z}=Il(d,m),T=nl,vl=a([]),_=a([]);a([]);const A=a([]),R=a([]),ml=Tl(()=>(R.value||[]).reduce((s,t)=>s+Number(t.value||0),0)>0),fl=a([]),V=a(""),J=il,bl=pl,B=a([]),Y=a([]);function xl(s){try{return new Date(s).toLocaleString()}catch{return String(s)}}async function $(){V.value="",await Promise.all([ol(),dl(),z()]),(al.value||rl.value||cl.value)&&(V.value=g("stats.errorNotFound"));const s=ul.value||{};A.value=(s.referer||[]).map(e=>({source:e.referer||e.label||e.name||g("common.unknown"),count:Number(e.count||e.value||0)}));const t=(s.device||[]).map(e=>({key:String(e.device||e.label||e.name||"unknown").toLowerCase(),count:Number(e.count||e.value||0)})),p=t.filter(e=>e.key.includes("mobile")||e.key.includes("phone")||e.key.includes("ios")||e.key.includes("android")).reduce((e,v)=>e+v.count,0),c=t.filter(e=>e.key.includes("desktop")||e.key.includes("pc")).reduce((e,v)=>e+v.count,0),f=t.filter(e=>e.key.includes("tablet")||e.key.includes("pad")).reduce((e,v)=>e+v.count,0);R.value=[{label:"移动",value:p},{label:"平板",value:f},{label:"桌面",value:c}],fl.value=(s.city||[]).slice(0,10).map(e=>({city:e.city||e.label||e.name||g("common.unknown"),count:Number(e.count||e.value||0)})),vl.value=(s.device||[]).map(e=>({label:e.label||e.name||e.key||g("common.unknown"),value:Number(e.count||e.value||0)})),_.value=(s.city||[]).slice(0,5).map(e=>({label:e.city||e.label||e.name||g("common.unknown"),value:Number(e.count||e.value||0)}));const n=Array.isArray(H.value)?H.value:[],C=Array.from(new Set(n.map(e=>String(e.date)))).sort();B.value=C;const S=new Map(n.map(e=>[String(e.date),Number(e.visits||e.count||0)]));Y.value=C.map(e=>S.get(e)??0)}function gl(){P.push("/")}function yl(){P.push("/dashboard")}function Z(s){m.value=s}_l(m,async()=>{console.debug("[watch] selectedDays ->",m.value),await z(),await $()});function wl(){I.value={start:y.value,end:w.value,source:q.value,device:k.value,city:D.value,page:0,size:20},$()}async function ql(){await G("csv")}async function kl(){await G("json")}async function G(s){const t={start:y.value,end:w.value,source:q.value,device:k.value,city:D.value};await Hl(d,t,s)}const y=a(""),w=a(""),q=a(""),k=a(""),D=a(""),F=a(!1);function Dl(){F.value=!0}function Cl(){F.value=!1}function Sl(){F.value=!1,wl()}function hl(){q.value="",k.value="",D.value=""}return Al($),function(){try{const t=new Date,p=t.getFullYear(),c=t.getMonth(),f=new Date(p,c,1),n=new Date(p,c+1,0),C=S=>{const e=S.getFullYear(),v=String(S.getMonth()+1).padStart(2,"0"),Vl=String(S.getDate()).padStart(2,"0");return`${e}-${v}-${Vl}`};y.value=C(f),w.value=C(n)}catch{}}(),(s,t)=>{var p,c,f;return i(),r("div",zl,[l("div",Jl,[l("div",Yl,[l("div",Zl,[t[8]||(t[8]=l("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[l("path",{d:"M3 10.5L12 3l9 7.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-9.5Z",stroke:"currentColor","stroke-width":"1.5","stroke-linejoin":"round"})],-1)),l("span",null,o(s.$t("stats.breadcrumb",{code:u(d)})),1)]),l("div",Gl,[l("button",{onClick:gl,class:"fx-btn fx-gray"},[...t[9]||(t[9]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"返回首页",-1)])]),l("button",{onClick:yl,class:"fx-btn fx-gray"},[...t[10]||(t[10]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"返回看板",-1)])]),l("button",{onClick:t[0]||(t[0]=n=>u(sl)(U)),class:"fx-btn fx-gray"},[...t[11]||(t[11]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"复制短链",-1)])]),l("button",{onClick:Dl,class:"fx-btn fx-purple"},[...t[12]||(t[12]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"筛选",-1)])])])]),l("div",Kl,[l("div",Ql,[l("div",Wl,[t[15]||(t[15]=l("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[l("path",{d:"M4 17l6-6 4 4 6-7",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t[16]||(t[16]=l("span",null,"访问趋势",-1)),l("div",Xl,[l("button",{class:K(["fx-btn fx-gray fx-sm",{"font-semibold":m.value===7}]),onClick:t[1]||(t[1]=n=>Z(7))},[...t[13]||(t[13]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"7天",-1)])],2),l("button",{class:K(["fx-btn fx-purple fx-sm",{"font-semibold":m.value===30}]),onClick:t[2]||(t[2]=n=>Z(30))},[...t[14]||(t[14]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"30天",-1)])],2)])]),l("div",lt,[(i(),L(E,null,{fallback:x(()=>[...t[17]||(t[17]=[l("div",{class:"h-[220px] q-card"},null,-1)])]),default:x(()=>[M(u(X),{values:Y.value,labels:B.value,showValues:!0},null,8,["values","labels"])]),_:1}))]),!B.value.length&&!u(bl)?(i(),r("div",tt,o(s.$t("common.noData")),1)):b("",!0)])]),l("div",et,[l("div",st,[t[19]||(t[19]=l("div",{class:"q-card-title mb-3"},"来源渠道占比",-1)),(i(),L(E,null,{fallback:x(()=>[...t[18]||(t[18]=[l("div",{class:"h-[240px] q-card"},null,-1)])]),default:x(()=>[M(u(ll),{data:A.value},null,8,["data"])]),_:1})),!A.value.length&&!u(J)?(i(),r("div",nt,o(s.$t("common.noData")),1)):b("",!0)]),l("div",at,[t[21]||(t[21]=l("div",{class:"q-card-title mb-3"},"设备占比",-1)),(i(),L(E,null,{fallback:x(()=>[...t[20]||(t[20]=[l("div",{class:"h-[240px] q-card"},null,-1)])]),default:x(()=>[M(u(W),{type:"pie",data:R.value,engine:"echarts"},null,8,["data"])]),_:1})),!ml.value&&!u(J)?(i(),r("div",ot,o(s.$t("common.noData")),1)):b("",!0)])]),F.value?(i(),r("div",ut,[l("div",it,[t[31]||(t[31]=l("div",{class:"tf-modal-header"},"筛选条件",-1)),l("div",rt,[l("div",null,[t[22]||(t[22]=l("label",{class:"q-muted text-[13px]"},"开始日期",-1)),h(l("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>y.value=n),type:"date",class:"q-input mt-1 w-full"},null,512),[[N,y.value]])]),l("div",null,[t[23]||(t[23]=l("label",{class:"q-muted text-[13px]"},"结束日期",-1)),h(l("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>w.value=n),type:"date",class:"q-input mt-1 w-full"},null,512),[[N,w.value]])]),l("div",null,[t[24]||(t[24]=l("label",{class:"q-muted text-[13px]"},"来源",-1)),h(l("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>q.value=n),type:"text",placeholder:"不填为全部",class:"q-input mt-1 w-full"},null,512),[[N,q.value]])]),l("div",null,[t[26]||(t[26]=l("label",{class:"q-muted text-[13px]"},"设备",-1)),h(l("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>k.value=n),class:"q-input mt-1 w-full"},[...t[25]||(t[25]=[Bl('<option value="" data-v-4aeeb3e2>全部</option><option value="mobile" data-v-4aeeb3e2>移动</option><option value="desktop" data-v-4aeeb3e2>桌面</option><option value="tablet" data-v-4aeeb3e2>平板</option><option value="bot" data-v-4aeeb3e2>爬虫</option>',5)])],512),[[Rl,k.value]])]),l("div",null,[t[27]||(t[27]=l("label",{class:"q-muted text-[13px]"},"城市",-1)),h(l("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>D.value=n),type:"text",placeholder:"不填为全部",class:"q-input mt-1 w-full"},null,512),[[N,D.value]])])]),l("div",{class:"mt-6 flex items-center justify-end gap-3"},[l("button",{class:"fx-btn fx-gray fx-sm",onClick:hl},[...t[28]||(t[28]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"重置",-1)])]),l("button",{class:"fx-btn fx-purple fx-sm",onClick:Sl},[...t[29]||(t[29]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"应用筛选",-1)])]),l("button",{class:"fx-btn fx-gray fx-sm",onClick:Cl},[...t[30]||(t[30]=[l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",null,null,-1),l("span",{class:"btn-text"},"取消",-1)])])])])])):b("",!0),l("div",dt,[l("div",pt,[l("div",null,[t[32]||(t[32]=l("div",{class:"q-muted text-[13px]"},"短码",-1)),l("div",ct,o(u(d)),1)]),l("div",null,[t[33]||(t[33]=l("div",{class:"q-muted text-[13px]"},"短链",-1)),l("a",{href:U,target:"_blank",class:"mt-1 q-link"},o(el))]),l("div",null,[t[34]||(t[34]=l("div",{class:"q-muted text-[13px]"},"创建时间",-1)),l("div",vt,o(xl((p=u(T))==null?void 0:p.createdAt)),1)]),l("div",null,[t[35]||(t[35]=l("div",{class:"q-muted text-[13px]"},"总访问量",-1)),l("div",mt,o(((c=u(T))==null?void 0:c.totalVisits)??"-"),1)]),l("div",null,[t[36]||(t[36]=l("div",{class:"q-muted text-[13px]"},"今日访问量",-1)),l("div",ft,o(((f=u(T))==null?void 0:f.todayVisits)??"-"),1)]),l("div",null,[t[37]||(t[37]=l("div",{class:"q-muted text-[13px]"},"Top 城市",-1)),l("div",bt,[(i(!0),r(Ll,null,El(_.value,n=>(i(),r("div",{key:n.label,class:"flex items-center justify-between"},[l("span",xt,o(n.label),1),l("span",gt,o(n.value),1)]))),128)),_.value.length?b("",!0):(i(),r("div",yt,o(s.$t("common.noData")),1))])])])]),V.value?(i(),r("div",wt,[Ml(o(V.value)+" ",1),l("button",{class:"ml-3 q-btn-ghost px-3 py-1",onClick:$},o(s.$t("stats.retry")),1),l("button",{class:"ml-3 q-btn-ghost px-3 py-1",onClick:ql},"导出 CSV"),l("button",{class:"ml-3 q-btn-ghost px-3 py-1",onClick:kl},"导出 JSON")])):b("",!0)])])}}},St=$l(qt,[["__scopeId","data-v-4aeeb3e2"]]);export{St as default};
