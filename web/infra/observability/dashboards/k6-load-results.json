{
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.0.0" },
    { "type": "datasource", "id": "influxdb", "name": "InfluxDB", "version": "1.0.0" }
  ],
  "__inputs": [
    { "name": "DS_INFLUXDB", "label": "InfluxDB", "type": "datasource", "pluginId": "influxdb", "pluginName": "InfluxDB" }
  ],
  "title": "K6 Load Testing Results",
  "tags": ["k6", "influxdb"],
  "timezone": "",
  "schemaVersion": 38,
  "style": "dark",
  "editable": true,
  "graphTooltip": 0,
  "panels": [
    {
      "type": "timeseries",
      "title": "Active VUs",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT mean(\"value\") FROM \"vus\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Requests per Second",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT non_negative_derivative(sum(\"value\"), 1s) FROM \"http_reqs\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Errors per Second",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 0 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT non_negative_derivative(sum(\"value\"), 1s) FROM \"http_req_failed\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Checks per Second",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 8 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT non_negative_derivative(sum(\"value\"), 1s) FROM \"checks\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "http_req_duration (p95)",
      "gridPos": { "h": 8, "w": 16, "x": 8, "y": 8 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT percentile(\"value\", 95) FROM \"http_req_duration\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "TTFB (waiting) p95",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 20 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT percentile(\"value\", 95) FROM \"http_req_waiting\" WHERE $timeFilter GROUP BY time($__interval) fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Status Codes (count)",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 20 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT count(\"value\") FROM \"http_req_duration\" WHERE $timeFilter GROUP BY time($__interval), \"status\" fill(null)",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "stat",
      "title": "http_req_duration (count)",
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 16 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT count(\"value\") FROM \"http_req_duration\" WHERE $timeFilter",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "stat",
      "title": "http_req_duration (min)",
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 16 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT min(\"value\") FROM \"http_req_duration\" WHERE $timeFilter",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "stat",
      "title": "http_req_duration (mean)",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 16 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT mean(\"value\") FROM \"http_req_duration\" WHERE $timeFilter",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "stat",
      "title": "http_req_duration (p95)",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 16 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT percentile(\"value\", 95) FROM \"http_req_duration\" WHERE $timeFilter",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    },
    {
      "type": "stat",
      "title": "http_req_duration (max)",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 16 },
      "datasource": { "type": "influxdb", "uid": "${DS_INFLUXDB}" },
      "targets": [
        {
          "refId": "A",
          "query": "SELECT max(\"value\") FROM \"http_req_duration\" WHERE $timeFilter",
          "rawQuery": true,
          "resultFormat": "time_series"
        }
      ]
    }
  ],
  "templating": { "list": [] },
  "time": { "from": "now-15m", "to": "now" },
  "timepicker": { "refresh_intervals": ["5s", "10s", "30s", "1m"], "time_options": ["5m", "15m", "1h", "6h", "12h", "24h"] }
}
